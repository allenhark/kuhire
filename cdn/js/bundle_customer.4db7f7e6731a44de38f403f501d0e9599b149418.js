
jQuery(function($){if(jQuery('.account-page-tracker').length){function showPanel(tracker_nav_id){if(jQuery("#"+tracker_nav_id).hasClass("act")){return;}
jQuery('.tracker-nav-button').removeClass('act');jQuery("#"+tracker_nav_id).addClass("act");jQuery(".item-panel").hide();jQuery(tracker_nav_id=="tn-performers"?'#performers-panel':'#events-panel').show();jQuery("#team-band-input").focus();}
if(window.location.hash.indexOf("#events")>=0){showPanel("tn-events");}
jQuery('.tracker-nav-button').click(function(){showPanel(this.id);});jQuery('#team-band-input').keydown(function(){if(jQuery("#team-band-input-prompt").filter(':visible').length>0){jQuery("#team-band-input-prompt").hide();}});var tracked_events=new SG.Preferences.Events();tracked_events.on("reset",function(){tracked_event_view.render();});tracked_events.fetch();var tracked_event_view=new SG.Preferences.EventsPanelView({el:$('#events-panel'),collection:tracked_events});var tracked_performers=new SG.Preferences.Performers();tracked_performers.on("add remove",function(pref){SG.set_cookie("sg_recompute","1",7*24*60*60*1000);$("#no-performers-message")[tracked_performers.likesCount()?"hide":"show"]();});tracked_performers.fetch();var tracked_performers_view=new SG.Preferences.PerformersPanelView({el:$("#performers-panel-lower"),collection:tracked_performers});var autocomplete=new SG.Preferences.PerformerAutocompleteView({el:jQuery("#performers-panel-upper")});autocomplete.render();autocomplete.on("select",function(performer_id){var prexisting=tracked_performers.find(function(p){return p.get("performer").id==performer_id;});if(prexisting&&prexisting.get("tracked")){alert("You're already tracking that performer.");}else{jQuery.ajax({type:"POST",url:"/preferences",data:{"performer.id":performer_id,"explicit.preference":"like","xsrf_token":SG.user.xsrf_token},success:function(resp){if(prexisting){tracked_performers.remove(prexisting);jQuery("#performers-panel-lower .tracked-performer").each(function(){if(jQuery(this).find(".rhs-info h5 a").text()==prexisting.get("performer").name){jQuery(this).remove();}});}
tracked_performers.add([resp.preference]);autocomplete.reset();if(resp.facebook=="reauth"){SG.fb_relogin();}},error:function(){alert("Whoops, there was an error adding your preference.");}});}});autocomplete.input.keyup(function(){var val=autocomplete.input.val();if(val.length<2){$("#no-performers-message")[tracked_performers.likesCount()?"hide":"show"]();$('#no-matching-performers-message').hide();$('#performers-panel-lower .tracked-performer').show();return;}else{$("#no-performers-message").hide();}
var count=0;var term_words=val.toLowerCase().split(/\s+/g);jQuery("#performers-panel-lower .tracked-performer").each(function(){var name_words=jQuery(this).find(".rhs-info h5 a").text().toLowerCase().split(/\s+/g);for(x in term_words){var found=false;for(y in name_words){if(name_words[y].indexOf(term_words[x])==0){found=true;break;}}
if(!found){this.style.display="none";return;}}
jQuery(this).show();count+=1;});$('#no-matching-performers-message')[count?"hide":"show"]();});}});jQuery(function(){var loaded=false;SG.show_ticket_analytics=function(callback){var popup=jQuery("#ticket-analytics-popup");loaded=true;sglightbox.open(popup[0]);if(SG.map)SG.map.track("analytics-window-show");if(callback)callback();SG.chart.load();};jQuery('#ticket-analytics').click(function(e){e.preventDefault();if(SG.map)SG.map.track("analytics-button-click");SG.ensure_authenticated(function(){SG.show_ticket_analytics();},'Please login to view ticket analytics');});});SG=window.SG||{};SG.API=(function($){var API={};API.config={base:('https:'==document.location.protocol?'https':'http')+"://api.seatgeek.com/2",aid:null};API.get=function(path,opts){return API.request("GET",path,opts);};API.post=function(path,opts){return API.request("POST",path,opts);};API.request=function(method,path,opts){opts=opts||{};opts.data=opts.data||{};if(API.config.aid&&!opts.data.aid){opts.data.aid=API.config.aid;}
return $.ajax({type:method,url:API.config.base+path,dataType:"jsonp",data:opts.data});};return API;})(jQuery);function initiateAutocomplete(){var cache={},url="/autocomplete?types[]=event&types[]=teamband&types[]=venue&types[]=tournament",lastXhr,options={minLength:2,delay:125,parent:jQuery('.search-form, .search-structure'),source:function(request,response){var params={term:request.term,limit:3};var term=request.term;if(term in cache){response(cache[term]);return;}
lastXhr=jQuery.getJSON(url,params,function(data,status,xhr){cache[term]=data;if(xhr===lastXhr){response(data);}}).error(function(){response({term:term,results:{}});});}};if(jQuery('.outbound-search').is("*")){options.presubmit=function(event,ui){if(this.menu.is(":visible")&&this.focus&&this.focus>0){SG.fn.also_search();}};_gaq.push(['_trackEvent','ads','impression','goldstar-home-page-checkbox',undefined,true]);}
jQuery("#search-bar-input").add("#searchBarInput").add("#search-input").sgautocomplete(options);}
jQuery(function(){initiateAutocomplete();});jQuery(function(){if(jQuery('.brokers-signup').length||jQuery('.partners-signup').length){jQuery("#account-yes").click(function(){jQuery("#signin").show();jQuery("#signup").hide();});jQuery("#account-no").click(function(){jQuery("#signin").hide();jQuery("#signup").show();});}});jQuery(function($){$.fn.loadEvents=function(url,page,callback){var obj=$(this);if(!page)page=1;$.ajax({url:url+'&page='+page,dataType:'jsonp',crossDomain:true,success:function(data){if(typeof callback==='function')callback(data);if(data.events.length===0){obj.html('<p class="error">Unfortunately, there aren\'t any upcoming events near you.</p>');return;}
$(data.events).each(function(){var date=this.datetime_local,months=['January','Februrary','March','April','May','June','July','August','September','October','November','December'],month=months[parseInt(date.substr(5,2),10)-1],day=parseInt(date.substr(8,2),10),hours=parseInt(date.substr(11,2),10),hour=hours>12?hours-12:hours,min=date.substr(14,2),ampm=hours>=12&&hours<24?'PM':'AM',daystring='<span class="daystring">'+month+' '+day+'</span>',timestring='<span class="timestring">'+(hour!==3?hour+':'+min+' '+ampm:'TBA')+'</span>',shortTitle=this.title.length>36?this.title.substr(0,34)+'&hellip;':this.title,shortLoc=this.venue.name.length>30?this.venue.name.substr(0,28)+'&hellip;':this.venue.name;obj.append(['<a href="'+this.url+'" class="event">',this.performers[0].image?'<img src="'+this.performers[0].image+'" alt/>':'<div class="no-image"></div>','<h3 title="'+this.title+'">'+shortTitle+'</h3>','<p>','<span class="datetime">',daystring+' at '+timestring,'</span>','<span class="location"><span title="'+this.venue.name+'">'+shortLoc+'</span>, '+this.venue.city+', '+this.venue.state+'</span>','</p>','</a>'].join(""));});var pages=Math.ceil(data.meta.total/data.meta.per_page);if(page>=pages)return;var link=$('<a href="#"></a>').text('Load More').attr('data-url',url).attr('data-page',parseInt(page,10)+1).addClass('paginate');link.click(function(e){e.preventDefault();var $this=$(this).html('Loading&hellip;');obj.loadEvents($this.attr('data-url'),$this.attr('data-page'),function(){$this.remove();});});obj.append(link);},error:function(){obj.html('<p class="error">There was a problem getting events. Please try reloading the page.');}});};});jQuery(function($){if(!$('.home').length)return;if(!('ontouchstart'in window)){$(window).on("scroll",function(e){var scrollTop=$(window).scrollTop();if(scrollTop>=686)return;var translate='translate3d(0, '+(scrollTop/2-30)+'px, 0)';$('#bg-scroll').css({'-webkit-transform':translate,'-moz-transform':translate,'transform':translate});});}
$('.search-suggestions a').click(function(e){e.preventDefault();var array=$(this).text().split(""),input=$("#search-input").focus().val(''),i=0;var typeInput=function(){if(i==array.length){$(".search-submit-large").addClass('hovered');setTimeout(function(){$(".search-submit-large").removeClass('hovered').addClass('actived');$("#search-form").submit();},300);return;}
input.val(input.val()+array[i]).trigger('keydown');i++;setTimeout(typeInput,40);};typeInput();});$('#upcoming-events').loadEvents("http://api.seatgeek.com/2/events?per_page=6&amp;sort=score.desc",1);$('#nearby-events').loadEvents("http://api.seatgeek.com/2/events?per_page=6&amp;geoip=true&amp;sort=score.desc",1);var input=$("#search-input"),searchForm=$('#search-form'),searchGhost=$("#search-ghost");input.focus(function(){if(input.val()==input.attr("rel")){input.val("");searchGhost.show();}
searchForm.addClass('focused');}).blur(function(){if(input.val()==="")input.val(input.attr("rel"));searchGhost.hide();searchForm.removeClass('focused');}).bind('keydown paste cut',function(){setTimeout(function(){if(input.val()==="")searchGhost.fadeIn(200);else searchGhost.hide();},0);});$('#iphone-form').on("submit",function(e){e.preventDefault();var val=$('#phone_number').val();if(val===''){$('.iphone-message').addClass('error').html('<strong>Error:</strong> Please enter a phone number.');$('#phone_number').focus();return false;}
$('.iphone-submit').val('Loading...');$.ajax({url:'/main/send_sms',type:'POST',data:{'number':val},success:function(){$('.iphone-container').addClass('flip');},failure:function(){$('.iphone-message').addClass('error').html('<strong>Error:</strong> There was an error. Please try again.');$('#phone_number').focus();}});});$('#iphone-success-wrapper .iphone-close').click(function(e){e.preventDefault();$('.iphone-container').removeClass('flip');$('.iphone-message').html('Or have a link sent to your iPhone:');$('.iphone-submit').val('Get it Now');});$('#mobile-send-link').click(function(e){e.preventDefault();var coords=$(this).position();var container=$('.iphone-container');container.css({left:coords.left+($(this).width()/2)-(container.width()/2)+'px',top:coords.top+$(this).outerHeight()+5+'px'}).toggle();});$('.iphone-container .iphone-close-mobile').click(function(e){e.preventDefault();$('.iphone-container').hide();});$('.search-input').focus();});Browser={};Browser.IE=navigator.userAgent.indexOf("MSIE")!=-1;Browser.IE6=Browser.IE&&parseInt(navigator.userAgent.substring(navigator.userAgent.indexOf("MSIE")+5))==6;Browser.IE7=Browser.IE&&parseInt(navigator.userAgent.substring(navigator.userAgent.indexOf("MSIE")+5))==7;Browser.IE8=Browser.IE&&parseInt(navigator.userAgent.substring(navigator.userAgent.indexOf("MSIE")+5))==8;Browser.WebKit=navigator.userAgent.indexOf("WebKit")!=-1;if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,'');};}
if(!String.prototype.capitalize){String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1);};}
window.onload=function(){if(!!window.devicePixelRatio){if(window.devicePixelRatio>1){var html=document.getElementsByTagName('html')[0];html.className+=' highres';}}};function async(fn,timeout){var timeout=timeout||0;return setTimeout(fn,timeout);}
function yieldingMap(f,xs,callback){var ret=[],i=0,len=xs.length,start,timeout;function cancel(){clearTimeout(timeout);}
function process(){for(start=+new Date;i<len&&((+new Date)-start<25);++i){ret[i]=f.call(xs[i],xs[i],i);}
if(i<len){timeout=async(process);}else if(typeof callback==="function"){callback(ret);}}
timeout=async(process);return cancel;}
function sometimeWhen(test,then,period){var period=period||50;async(function(){if(test()){then();}else{async(arguments.callee,period);}},period);}
jQuery.ajaxSetup({cache:false});var SG=SG||{};_.extend(SG,(function(){var login_deferred=null,short_summary=false,short_form=false,short_submit=false,CHARS='0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.split('');return{set_cookie:function(key,value,expiresMultiplier){var date=new Date();expiresMultiplier=expiresMultiplier||0;date.setTime(date.getTime()+expiresMultiplier);document.cookie=key+"="+value+"; expires="+date.toGMTString()+"; path=/";},get_cookie:function(key){var cookies=document.cookie.split(';'),key=key+"=",i=0,c;for(i=0;i<cookies.length;++i){c=cookies[i];while(c.charAt(0)==' '){c=c.substring(1,c.length);}
if(c.indexOf(key)==0){return c.substring(key.length,c.length);}}
return null;},delete_cookie:function(key){SG.set_cookie(key,"",0);},get_user_id:function(){var matches=unescape(SG.get_cookie("sg_sess")).match(/"user_id";i:(\d+);/);return matches&&matches.length==2?parseInt(matches[1],0):null;},is_authenticated:function(){var user_id=this.get_user_id();return user_id!==null;},ensure_authenticated:function(callback,message){if(!this.is_authenticated()){this.login(callback,message);}else{callback.call();}},register:function(callback,message){var that=this,win=jQuery(window),popup=jQuery('#register-popup'),form=jQuery('#register-form'),button=jQuery('#register-button'),loader=jQuery('#register-loader'),link=jQuery('.have-an-account');register_deferred=_.extend({},Backbone.Events);function modal_closed(){win.unbind("sglightbox:close",modal_closed);register_deferred.trigger("error");}
register_deferred.on("success",function(){win.unbind("sglightbox:close",modal_closed);register_deferred=null;});register_deferred.on("success",function(){var register_email=form.find('#register-email').val()||'';that.track_register(register_email,'email');});register_deferred.on("error",function(){register_deferred=null;});win.bind("sglightbox:close",modal_closed);register_deferred.on("success",function(){window.location='/account/welcome';});register_deferred.on("success",callback);if(this.is_authenticated()){_.defer(function(){register_deferred.trigger("success",{type:null});});return register_deferred;}
jQuery('#register-popup-message').html(message?message:"Register with SeatGeek");sglightbox.open(popup[0]);popup.find('input.autofocus').focus();setTimeout(function(){popup.find('input').each(function(){if(jQuery(this).val()!==""){jQuery(this).siblings('label').hide();}});},0);form.unbind("submit");form.submit(function(e){button.addClass("disabled").val("Loading...");loader.show();link.hide();jQuery("#register-missing, #register-invalid").hide();jQuery.post(form.attr("action"),form.serializeArray(),function(json){loader.hide();link.show();if(json&&!json.error){_gaq.push(['_trackEvent','sg_login','user-registered','sg-submit',undefined,true]);_gaq.push(['_trackEvent','account','register','sg',undefined,true]);jQuery('#register-options').fadeOut('slow');jQuery('#register-success').fadeIn('slow');register_deferred.trigger("success",{type:"normal"});}else{button.removeClass("disabled").val('Register');if(!jQuery("#register-email").val()||!jQuery("#register-pass")){jQuery("#register-missing").fadeIn();}else{if(json.message)jQuery("#register-invalid").html(json.message);jQuery("#register-invalid").fadeIn();}
jQuery("#register-pass").val("").trigger("forceUpdate").focus();if(jQuery('#register-email').val()===''){jQuery('#register-email').focus();}}},"json");return false;});return register_deferred;},track_register:function(user,type){var that=this,t=new SG.Tracker(),params=_.extend({category:"sg:account:register",url:location.href,type:type,user:user},that.params);t.track(params);},login:function(callback,message){var win=jQuery(window),popup=jQuery('#login-popup');login_deferred=_.extend({},Backbone.Events);function modal_closed(){win.unbind("sglightbox:close",modal_closed);login_deferred.trigger("error");}
login_deferred.on("success",function(){win.unbind("sglightbox:close",modal_closed);login_deferred=null;});login_deferred.on("error",function(){login_deferred=null;});win.bind("sglightbox:close",modal_closed);login_deferred.on("success",callback);if(this.is_authenticated()){_.defer(function(){login_deferred.trigger("success",{type:null});});return login_deferred;}
jQuery('#login-register-popup-message').html(message?message:"Login to SeatGeek");sglightbox.open(popup[0]);popup.find('input.autofocus').focus();setTimeout(function(){popup.find('input').each(function(){if(jQuery(this).val()!==""){jQuery(this).siblings('label').hide();}});},0);var form=jQuery('#login-form'),button=jQuery('#login-button'),loader=jQuery('#login-loader');form.unbind("submit");form.submit(function(e){button.addClass("disabled").val("Loading...");loader.show();jQuery("#login-missing, #login-invalid").hide();jQuery.post(form.attr("action"),form.serializeArray(),function(json){loader.hide();if(json&&!json.error){_gaq.push(['_trackEvent','sg_login','user-logged-in','submit',undefined,true]);jQuery('#login-options').fadeOut('slow');jQuery('#login-success').fadeIn('slow');if(jQuery('.wrapper').hasClass('home')&&window.location.pathname=='/'){window.location.reload();}else{setTimeout(function(){sglightbox.close();},2000);}
jQuery("#logged-in-nav").attr("access",json.access);login_deferred.trigger("success",{type:"normal"});jQuery(document).trigger("sg:login",json);}else{button.removeClass("disabled").val('Login');if(!jQuery("#login-email").val()||!jQuery("#login-pass")){jQuery("#login-missing").fadeIn();}else{if(json.message)jQuery("#login-invalid").html(json.message);jQuery("#login-invalid").fadeIn();}
jQuery("#login-pass").val("").trigger("forceUpdate").focus();if(jQuery('#login-email').val()==''){jQuery('#login-email').focus();}}},"json");return false;});return login_deferred;},logout:function(){FB.getLoginStatus(function(response){if(response.authResponse){FB.logout(function(){jQuery(document).trigger("sg:logout");document.location="/logout/";});}else{document.location="logout/index.html";}});return false;},quiet_logout:function(){FB.getLoginStatus(function(response){if(response.authResponse){FB.logout();}});url="/account/quietlogout";jQuery.get(url,function(json){if(json.success){jQuery(document).trigger("sg:logout");}});},fb_connect_cb:function(){setTimeout(function(){var form=jQuery('#fblogin');if(location.pathname.match(/\/(login|register)/i)){_gaq.push(['_trackEvent','sg_login','user-registered','fb-submit-shortcircuit',undefined,true]);return form.submit();}
jQuery.post(form.attr("action"),form.serializeArray(),function(json){var fbSubmitType=!window.location.href.match(/blog/)?'fb-submit':'fb-submit-blog';if(json.success){if(login_deferred){login_deferred.trigger("success",{type:"facebook"});}
jQuery(document).trigger("sg:login",json);if(jQuery('.wrapper').hasClass('home')&&window.location.pathname=='index.html'){if(json['new']){_gaq.push(['_trackEvent','sg_login','user-registered',fbSubmitType,undefined,true]);_gaq.push(['_trackEvent','account','register','fb',undefined,true]);window.location='/account/welcome';}else{window.location.reload();}}else{if(json['new']){_gaq.push(['_trackEvent','sg_login','user-registered',fbSubmitType,undefined,true]);_gaq.push(['_trackEvent','account','register','fb',undefined,true]);}
setTimeout(function(){sglightbox.close();},250);}
jQuery("#logged-in-nav").attr("access",json.access);}else if(json.error){sglightbox.close();}});},0);},fb_fail_cb:function(response){jQuery('.fb-loading').hide();},fb_relogin:function(){FB.login(function(response){if(response.authResponse){setTimeout(function(){jQuery.post("fblogin/index.html");});}},{scope:"email,user_interests,user_likes,user_location,publish_actions"});},fb_login:function(callback){jQuery('.fb-loading').show();FB.login(function(response){if(response.authResponse){SG.fb_connect_cb();if(callback)callback();}else{SG.fb_fail_cb(response);}},{scope:"email,user_interests,user_likes,user_location,publish_actions"});},load_script_async:function(url,is_ready,cb){var s=document.createElement('script'),h=document.getElementsByTagName('head')[0];s.type="text/javascript";s.async=true;s.src=url;h.appendChild(s);if(is_ready&&cb){sometimeWhen(is_ready,cb,50);}},like_button:function(elem,options){var options=jQuery.extend({style:"",action:"like",url:location.href,track:{},colorscheme:"light"},options),like_wrap=jQuery(elem),tracker=new SG.Tracker();like_wrap.html('<fb:like href="'+options.url+'" ref="'+tracker.getRef()+'" \
                  layout="button_count" show_faces="false" width="100" \
                  action="'+options.action+'" font="arial" \
                  style="'+options.style+'" colorscheme="'+options.colorscheme+'"></fb:like>');like_wrap.each(function(){FB.XFBML.parse(this);});FB.Event.subscribe('edge.create',function(response){tracker.track(options.track);});},sharer_button:function(elem,options){var options=jQuery.extend({style:"",url:location.href,message:'Share on facebook',track:{}},options),tracker=new SG.Tracker(),reffed_url=options.url+(options.url.match(/\?/)?'&':'?')+'ref='+tracker.getRef(),sharer_url="http://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(reffed_url),share_wrap=jQuery(elem);share_wrap.html('<a href="'+sharer_url+'" style="'+options.style+'" target="_blank">'+options.message+'</a>');share_wrap.find('a').click(function(response){tracker.track(options.track);});},share_email:function(options){var options=jQuery.extend({ajax:true,callback:null},options);this.ensure_authenticated(function(){sglightbox.open(jQuery("#share-email-popup")[0]);jQuery("#share-email-popup").find("#share_from_email").focus();var form=jQuery("#sglightbox_modal form");form.submit(function(e){form.find("#share_submitting").show();form.find("#share_submit").addClass("disabled").val("Loading...");jQuery("#to_email_invalid, #from_email_invalid").hide();var serialized=form.serializeArray();form.find("input").attr("disabled","disabled");jQuery.post(form.attr("action"),serialized,function(json){form.find("#share_submitting").hide();form.find("input").removeAttr("disabled");form.find("#share_submit").removeClass("disabled").val("Share");if(json.error){if(!jQuery("#share_to_email").val()){jQuery("#to_email_invalid").fadeIn();}else if(!jQuery("#share_from_email").val()){jQuery("#from_email_invalid").fadeIn();}}else{jQuery('#share-form').fadeOut('slow');jQuery('#share-success').fadeIn('slow');setTimeout(function(){sglightbox.close();},2000);if(options.callback)options.callback.call();}},"json");return false;});},"Please login to share this event");},fn:{fastHtmlToDom:(function(){var html_builder=document.createElement("div");return function fastInsert(html){html_builder.innerHTML=html;return html_builder.firstChild;};})(),serializeParams:function(obj){var str=[];for(var p in obj){if(jQuery.isArray(obj[p])){for(var i=0;i<obj[p].length;i++){if(obj[p]&&typeof(obj[p][i])!="function"){str.push(encodeURIComponent(p+"[]="+obj[p][i]));}}}else if(typeof obj[p]==="object"){for(var k in obj[p]){if(obj[p]){str.push(encodeURIComponent(p+"["+k+"]="+obj[p][k]));}}}else{if(obj[p]){str.push(p+"="+encodeURIComponent(obj[p]));}}}
return str.join("&");},parseUrl:function(url){var a=jQuery("<a></a>").attr("href",url)[0];return{pathname:a.pathname,search:a.search,host:a.host};},uuid:function(len,radix){var chars=CHARS,uuid=[];radix=radix||chars.length;if(len){for(var i=0;i<len;i++)uuid[i]=chars[0|Math.random()*radix];}else{var r;uuid[8]=uuid[13]=uuid[18]=uuid[23]='-';uuid[14]='4';for(var i=0;i<36;i++){if(!uuid[i]){r=0|Math.random()*16;uuid[i]=chars[(i==19)?(r&0x3)|0x8:r];}}}
return uuid.join('');},smartTruncate:function(text,len,append){text=text.trim();len=len||40;append=append||"";if(text.length>len){var re=new RegExp(".{0,"+len+"}\\b"),ms=text.match(re);return(ms?ms[0]:ms.slice(0,len)).trim()+append;}else{return text;}},strip_html:(function(){var dummy_div=document.createElement("div");return function(s){dummy_div.innerHTML=s;return dummy_div.innerText||dummy_div.textContent;}})()}};})());jQuery(document).bind("sg:login",function(e,json){if(json&&json.xsrf_token){SG.user.xsrf_token=json.xsrf_token;}});jQuery(document).bind("sg:login",function(){jQuery("#logged-out-nav").hide();jQuery("#logged-in-nav").show();if(jQuery("#ticket-analytics"))jQuery("#ticket-analytics").parent().show();});jQuery(document).bind("sg:logout",function(){jQuery("#logged-in-nav").removeAttr("access");jQuery("#logged-in-nav").hide();jQuery("#logged-out-nav").show();});jQuery(document).bind("fb:init",function(){FB.Event.subscribe('auth.authResponseChange',function(response){if(response.authResponse){SG.fb_connect_cb();}else if(response.status==='not_authorized'){}else{}});FB.getLoginStatus(function(response){if(response.authResponse){setTimeout(function(){jQuery.post("fblogin/index.html");});}});});jQuery(function($){var $inputs=jQuery(".input:not('.left-label') input");setTimeout(function(){$inputs.each(function(){var $input=$(this),$label=$input.siblings('label');if($input.val()!=="")$label.hide();$input.focus(function(){if($input.val()===""){$label.show().addClass('lighter');}else{$label.hide();}}).blur(function(){$label.removeClass('lighter');}).bind('keydown forceUpdate cut paste change propertychange touchstart',function(){setTimeout(function(){if($input.val()==="")$label.fadeIn(200);else $label.hide();},0);});$label.click(function(){$input.focus();});});},0);$inputs.filter('.autofocus').focus();});jQuery(function(){jQuery("input.ghosted").ghost();});jQuery(function(){jQuery('#login-link').click(function(e){SG.login();_gaq.push(['_trackEvent','sg_login','login-link','click',undefined,true]);return false;});jQuery('#register-link').click(function(e){SG.register();_gaq.push(['_trackEvent','sg_login','register-link','click',undefined,true]);return false;})
jQuery("#logout-link").click(function(e){_gaq.push(['_trackEvent','sg_login','logout-link','click',undefined,true]);e.preventDefault();return SG.logout();});jQuery('#go-sign-up').click(function(e){_gaq.push(['_trackEvent','sg_login','go-sign-up','click',undefined,true]);e.preventDefault();SG.register();});jQuery('#go-login').click(function(e){_gaq.push(['_trackEvent','sg_login','go-login','click',undefined,true]);e.preventDefault();SG.login();});if(window.navigator.platform.match(/ipad/gi)){jQuery('.nav-container').on('mouseover',function(){jQuery('body div').on('click',function(){});});}});jQuery(function(){if(jQuery('.categories_details #type').length){jQuery('#type').change(function(){jQuery(this).closest('form').submit();});}});jQuery(function(){if(jQuery('.referAFriendButton').length){jQuery('.referAFriendButton').click(function(e){var t=new SG.Tracker();t.track({"category":"refer:link","url":location.href});});}});jQuery(function(){var win=jQuery(window),btn=jQuery('#disable-mobile'),scrollTimer;if(btn.length){setTimeout(function(){btn.css({top:window.pageYOffset+window.innerHeight-btn.outerHeight()}).show();},0);win.on({'scroll.mobileButton':function(){clearTimeout(scrollTimer);btn.css({top:window.pageYOffset+window.innerHeight-btn.outerHeight()}).fadeIn(200);},'touchstart.mobileButton touchmove.mobileButton':function(e){clearTimeout(scrollTimer);if(!jQuery(e.target).closest('#disable-mobile').length){btn.hide();scrollTimer=setTimeout(function(){btn.fadeIn(200);},200);}},'gesturechange.mobileButton':function(e){jQuery('.footer').css({height:'350px'});btn.addClass('move-to-bottom');win.unbind('scroll.mobileButton touchstart.mobileButton touchmove.mobileButton gesturechange.mobileButton');}});}});function metaTab(tab){jQuery(".meta-tab").hide();jQuery("#"+tab+"-tab").show();jQuery(".meta-tabs li").removeClass('selected');jQuery("#"+tab+"-link").addClass('selected');}
var mode="meta";var search='';var current=0;var dateFilter='';var timeFilter='';var locationFilter='';jQuery(function(){var dropdownSelected=false,dropdownHover=false;jQuery('.dropdown-container label').mouseup(function(){var container=jQuery(this).parent(),reveal=jQuery(this).siblings('.dropdown-reveal');if(dropdownSelected){if(container.hasClass("show")){closeDropdown();return;}
closeDropdown();}
container.addClass("show");dropdownSelected=container;reveal.css("top",container.height()+"px");});jQuery('.dropdown-container').hover(function(){dropdownHover=true;},function(){dropdownHover=false;});jQuery('body').click(function(){if(dropdownSelected&&!dropdownHover)closeDropdown();});function closeDropdown(){dropdownSelected.removeClass("show");dropdownSelected=false;return false;}});jQuery(function(){jQuery(window).hashchange(function(){var defaultHash=jQuery('[href="#event-view"]')?'#event-view':'#events';hash=(location.hash||defaultHash);switch(hash){case'#events':view='event-view';break;case'#about':view='info-view';break;case'#ticket-prices':view='price-view';break;case'#seating-chart':view='seating-view';break;case'#tour-dates':view='tour-view';break;default:view='event-view';}
jQuery('ul.team-show-nav li a').each(function(){var that=jQuery(this);that.closest('li')[that.attr('href')===hash?'addClass':'removeClass']('active');});jQuery('ul.static-nav li a').each(function(){var that=jQuery(this);that.closest('li')[that.attr('href')===hash?'addClass':'removeClass']('active');});jQuery('.events-wrapper .view').each(function(){var that=jQuery(this);that[that.attr('id')===view?'show':'hide']();});});jQuery(window).hashchange();});jQuery(function(){if(jQuery('.full-chart').length>1)
jQuery('.full-chart').hide();else{jQuery('.show-hide span').html('Hide');jQuery('.show-hide i').addClass('shut');}
jQuery('.small-chart a').on('click',function(e){e.preventDefault();var parent=jQuery(this).closest('li'),lrgChart=parent.find('.full-chart'),button=parent.find('.show-hide span'),icon=parent.find('.show-hide i');lrgChart.slideToggle(500,function(){button['html'](lrgChart.is(':visible')?'Hide':'Show');icon[lrgChart.is(':visible')?'addClass':'removeClass']('shut');});});});jQuery(function(){if(jQuery('.toggle-container').length){var trackContainer=jQuery('.toggle-container'),team_id=trackContainer.attr('team_id'),params={},tooltipTitle=trackContainer.hasClass('tracking')?'stop tracking':'track';trackContainer.sg_toggle({state:trackContainer.hasClass('tracking')?'on':'off',init:function(){var obj=this.el;obj.tooltip({placement:'left'});if(obj.hasClass('tracking')){obj.find('.toggle-off').css({opacity:0.5});}
else{obj.find('.toggle-on').css({opacity:0.5});}},on:function(){var obj=this.el;obj.addClass("tracking").tooltip('hide');var success=false;obj.find('.toggle-on, .toggle-off').animate({opacity:0.5},100);SG.ensure_authenticated(function(){jQuery.post('/preferences',{"performer.id":team_id,"explicit.preference":"like","xsrf_token":SG.user.xsrf_token},function(resp){if(resp.facebook=="reauth"){SG.fb_relogin();}
obj.find('.toggle-on').animate({opacity:1},100);});success=true;},"Please login to track this performer");return success;},off:function(){var obj=this.el;obj.removeClass("tracking").tooltip('hide');var success=false;obj.find('.toggle-on, .toggle-off').animate({opacity:0.5},100);SG.ensure_authenticated(function(){jQuery.post('/preferences',{"performer.id":team_id,"explicit.preference":"dislike","xsrf_token":SG.user.xsrf_token},function(resp){if(resp.facebook=="reauth"){SG.fb_relogin();}
obj.find('.toggle-off').animate({opacity:1},100);});success=true;},"Please login to track this performer");return success;}});}});jQuery(function(){if(jQuery('.partner-new')){jQuery('.datepicker').datepicker({dateFormat:'yy-mm-dd'});}});jQuery(function(){if(jQuery('.sg-rdio-widget').length){var FlashDetect=new function(){var self=this;self.installed=false;self.raw="";self.major=-1;self.minor=-1;self.revision=-1;self.revisionStr="";var activeXDetectRules=[{"name":"ShockwaveFlash.ShockwaveFlash.7","version":function(obj){return getActiveXVersion(obj);}},{"name":"ShockwaveFlash.ShockwaveFlash.6","version":function(obj){var version="6,0,21";try{obj.AllowScriptAccess="always";version=getActiveXVersion(obj);}catch(err){}
return version;}},{"name":"ShockwaveFlash.ShockwaveFlash","version":function(obj){return getActiveXVersion(obj);}}];var getActiveXVersion=function(activeXObj){var version=-1;try{version=activeXObj.GetVariable("$version");}catch(err){}
return version;};var getActiveXObject=function(name){var obj=-1;try{obj=new ActiveXObject(name);}catch(err){obj={activeXError:true};}
return obj;};var parseActiveXVersion=function(str){var versionArray=str.split(",");return{"raw":str,"major":parseInt(versionArray[0].split(" ")[1],10),"minor":parseInt(versionArray[1],10),"revision":parseInt(versionArray[2],10),"revisionStr":versionArray[2]};};var parseStandardVersion=function(str){var descParts=str.split(/ +/);var majorMinor=descParts[2].split(/\./);var revisionStr=descParts[3];return{"raw":str,"major":parseInt(majorMinor[0],10),"minor":parseInt(majorMinor[1],10),"revisionStr":revisionStr,"revision":parseRevisionStrToInt(revisionStr)};};var parseRevisionStrToInt=function(str){return parseInt(str.replace(/[a-zA-Z]/g,""),10)||self.revision;};self.majorAtLeast=function(version){return self.major>=version;};self.minorAtLeast=function(version){return self.minor>=version;};self.revisionAtLeast=function(version){return self.revision>=version;};self.versionAtLeast=function(major){var properties=[self.major,self.minor,self.revision];var len=Math.min(properties.length,arguments.length);for(i=0;i<len;i++){if(properties[i]>=arguments[i]){if(i+1<len&&properties[i]==arguments[i]){continue;}else{return true;}}else{return false;}}};self.FlashDetect=function(){if(navigator.plugins&&navigator.plugins.length>0){var type='application/x-shockwave-flash';var mimeTypes=navigator.mimeTypes;if(mimeTypes&&mimeTypes[type]&&mimeTypes[type].enabledPlugin&&mimeTypes[type].enabledPlugin.description){var version=mimeTypes[type].enabledPlugin.description;var versionObj=parseStandardVersion(version);self.raw=versionObj.raw;self.major=versionObj.major;self.minor=versionObj.minor;self.revisionStr=versionObj.revisionStr;self.revision=versionObj.revision;self.installed=true;}}else if(navigator.appVersion.indexOf("Mac")==-1&&window.execScript){var version=-1;for(var i=0;i<activeXDetectRules.length&&version==-1;i++){var obj=getActiveXObject(activeXDetectRules[i].name);if(!obj.activeXError){self.installed=true;version=activeXDetectRules[i].version(obj);if(version!=-1){var versionObj=parseActiveXVersion(version);self.raw=versionObj.raw;self.major=versionObj.major;self.minor=versionObj.minor;self.revision=versionObj.revision;self.revisionStr=versionObj.revisionStr;}}}}}();};FlashDetect.JS_RELEASE="1.0.4";var chunk=function(a,s){for(var x,i=0,c=-1,l=a.length,n=[];i<l;i++)
(x=i%s)?n[c][x]=a[i]:n[++c]=[a[i]];return n;},buildPlayWidget=function(el,evts,performer){if(!FlashDetect.installed)el.remove();var identifier='sg-play-widget-'+Math.floor(Math.random()*1000),monthNames=["Jan","Feb","Mar","Apr","May","June","July","Aug","Sept","Oct","Nov","Dec"],innerHtml=[],rdio_station=null,rdio_image='images/sg-play-widget/default.png',performer_url=null,performer_name=null,chunk_count=0,pagination='';if(performer){chunks=chunk(evts,3);chunk_count=chunks.length;jQuery.each(chunks,function(e,evts){var evtTable=[];jQuery.each(evts,function(e,evt){var d=new Date(evt.datetime_local),l=evt.venue.city+', '+evt.venue.state;if(evt.performers[0].slug==performer){performer_name=evt.performers[0].name;performer_url=evt.performers[0].url;rdio_station=evt.performers[0].rdio_station;if(evt.performers[0].rdio_image!==undefined)rdio_image=evt.performers[0].rdio_image;}
evtTable.push(['<tr rdio_station="'+evt.performers[0].rdio_station+'">','<td><strong>'+l+'</strong> '+(l.length>15?'<br/ >':'')+monthNames[d.getMonth()]+' '+d.getDate()+'</td>','<td'+(l.length>15?' class="sg-play-widget-long"':'')+'><a href="'+evt.url+'">Tickets from $'+evt.stats.lowest_price+'</a></td>','</tr>'].join("\n"));});innerHtml.push(['<table>','<tbody>',evtTable.join("\n"),'</tbody>','</table>'].join("\n"));});}
if(chunk_count>1){pagination=[];for(var i=0;i<chunk_count;i++){pagination.push('<li><a>'+(i+1)+'</a></li>');}
pagination=['<ol class="sg-play-widget-nav">','</ol>'].join("\n");}
innerHtml=['<div class="sg-play-widget" id="'+identifier+'" first_play="1">','<div class="sg-play-widget-body">','<div class="sg-play-widget-album-art-container">','<img src="'+rdio_image+'" class="sg-play-widget-album-art"/>','<div class="sg-play-widget-album-shadow"></div>','<span class="sg-play-widget-prev"></span>','<span class="sg-play-widget-play"></span>','<span class="sg-play-widget-next"></span>','<span class="sg-play-widget-label"><span></span></span>','<span class="sg-play-widget-pause" style="display:none"></span>','</div>','<table>','<thead>','<tr>','<th class="sg-play-widget-artist">'+performer_name+'</th>','<th><a href="'+performer_url+'">'+(performer?'Upcoming events':'Buy Tickets')+'</a></th>','</tr>','</thead>','<tbody>','</tbody>','</table>','<div class="sg-play-widget-cycle">',innerHtml.join("\n"),'</div>','</div>','<div class="sg-play-widget-powered">','powered by <a href="index.html">seatgeek</a> and <a href="http://rdio.com/">rdio</a>','</div>','</div>'].join("\n");el.html(innerHtml);var $el=jQuery('#'+identifier);if(chunk_count>1){$el.find('.sg-play-widget-cycle').after('<ul class="sg-play-widget-nav">').cycle({fx:'none',pager:'#'+identifier+' .sg-play-widget-nav',pagerAnchorBuilder:function(idx,slide){return'<li><a href="#">'+idx+'</a></li>';},timeout:0});}
if(rdio_station!==null){$el.attr('rdio_station',rdio_station);$el.rdio('GAxPvxpk_____2R2cHlzNHd5ZXg3Z2M0OXdoaDY3aHdrbnNlYXRnZWVrLmNvbYEOAOPkRf5qYSERkRErEbg=');}
var play=function(e){jQuery('#'+identifier+' .sg-play-widget-play').hide();jQuery('#'+identifier+' .sg-play-widget-pause').show();if(jQuery('#'+identifier).attr('first_play')==='1'){jQuery('#'+identifier).attr('first_play','0');$el.rdio().play($el.attr('rdio_station'));}else{$el.rdio().play();}},pause=function(e){jQuery('#'+identifier+' .sg-play-widget-pause').hide();jQuery('#'+identifier+' .sg-play-widget-play').show();$el.rdio().pause();},next=function(e){if(currTimeout!==null)clearTimeout(currTimeout);$el.rdio().next();},prev=function(e){if(currTimeout!==null)clearTimeout(currTimeout);$el.rdio().previous();},currTimeout=null;$el.bind('playingTrackChanged.rdio',function(e,playingTrack,sourcePosition){if(playingTrack){$el.find('.sg-play-widget-album-art').attr('src',playingTrack.icon);$el.find('.sg-play-widget-label span').text(playingTrack.album+' - '+playingTrack.name);$el.find('.sg-play-widget-label').fadeIn();currTimeout=setTimeout(function(){$el.find('.sg-play-widget-label').fadeOut();},4000);}});jQuery('body').on('click','#'+identifier+' .sg-play-widget-play',play);jQuery('body').on('click','#'+identifier+' .sg-play-widget-pause',pause);jQuery('body').on('click','#'+identifier+' .sg-play-widget-next',next);jQuery('body').on('click','#'+identifier+' .sg-play-widget-prev',prev);};jQuery('.sg-rdio-widget').each(function(){var el=jQuery(this),limit=el.attr('limit');if(el.attr('performer')){jQuery.ajax({url:"http://seatgeek.com/team/blogwidget?performer="+el.attr('performer')+(limit!==undefined?'&limit='+limit:'')+'&callback=?',dataType:'json',success:function(json){buildPlayWidget(el,json.events,el.attr('performer'));},error:function(xhr,type){el.remove();}});}else if(el.attr('event_id')){jQuery.ajax({url:"http://seatgeek.com/team/blogwidget?event_id="+el.attr('event_id')+'&callback=?',dataType:'json',success:function(json){buildPlayWidget(el,json.events,false);},error:function(xhr,type){el.remove();}});}});}});jQuery(function(){SG.post_purchase=function(options){options=jQuery.extend({callback:null},options);jQuery(document).trigger("sg:post-purchase");sglightbox.open(jQuery("#post-purchase")[0]);SG.map.track("post-purchase-modal-show");};jQuery("#post-purchase a#facebook-button").click(function(){SG.map.track("post-purchase-modal-click","facebook");});jQuery("#post-purchase a#tweet-button").click(function(){SG.map.track("post-purchase-modal-click","twitter");});});var SG=SG||{};(function($){var P=SG.Preferences={};P.Event=Backbone.Model.extend({initialize:function(){this.set("datetime_local",Date.parse(this.get("datetime_local")));this.prepareTitle();},prepareTitle:function(){if(this.get("title").length>50){this.set("title",this.get("title").substring(0,47)+"...");}}});P.Performer=Backbone.Model.extend({initialize:function(){this.set("images",{huge:this.get("image")});},loadEvent:function(){var deferred=_.extend({},Backbone.Events),location=SG.user.location||{"geoip":"true"};SG.API.get("/events",{data:_.extend({"range":"50mi","performers.id":this.get("performer").id},location)}).success(function(resp){deferred.trigger("success",resp.events[0]);});return deferred;}});P.Events=Backbone.Collection.extend({model:P.Event,url:"/subscriptions",parse:function(response){return _.map(response.subscriptions,function(s){return s.event;});}});P.Performers=Backbone.Collection.extend({model:P.Performer,url:"/preferences",parse:function(response){return _.filter(response.preferences,function(p){return p.performer&&p.performer.name;});},comparator:function(preference){return preference.get("performer").name;},likesCount:function(){return this.filter(function(p){return p.get("tracked");}).length;}});P.SingleEventView=Backbone.View.extend({className:'tracked-event',tagName:'a',events:{"click .remove":function(e){var that=this;e.preventDefault();jQuery.ajax({type:"POST",url:"/account/remove_alert/",data:{"event_id":that.model.get("id")},success:function(resp){that.model.collection.remove([that.model]);that.$el.fadeOut(function(){that.$el.remove();});},error:function(){alert("Whoops, there was an error removing your tracked event.");}});}},initialize:function(){this.render();},render:function(){var that=this;this.$el.hover(function(){that.$(".remove").show();},function(){that.$(".remove").hide();});jQuery(this.el).attr('href',this.model.get('url'));var template=_.template(jQuery("#event_template").html(),this.model.toJSON());jQuery(this.el).html(template);return this;}});P.EventsPanelView=Backbone.View.extend({eventsList:[],render:function(){var that=this;jQuery("#event-panel-loading").hide();if(this.collection.length===0){jQuery("#no-events-message").show();}else{this.collection.each(function(m){var ev=new P.SingleEventView({model:m});jQuery("#events-panel").append(ev.render().el);that.eventsList.push(ev);});}}});P.SinglePerformerView=Backbone.View.extend({className:'tracked-performer',events:{"click .dislike":function(e){var that=this;e.preventDefault();jQuery.ajax({type:"POST",url:"/preferences",data:{"performer.id":that.model.get("performer").id,"explicit.preference":"dislike","xsrf_token":SG.user.xsrf_token},success:function(resp){that.model.collection.remove([that.model]);that.$el.fadeOut(function(){that.$el.remove();});},error:function(){alert("Whoops, there was an error removing your preference.");}});}},initialize:function(){this.template=_.template(jQuery("#performer_template").html());this.perfObj=this.model.get("performer");this.model.set("type",this.setType());},setType:function(){if(this.perfObj.type=="band"){return"band";}else if(jQuery.inArray(this.perfObj.type,['nba','nhl','nfl','mlb'])>-1){return"team";}else{return"unkown";}},getNoShowMessage:function(){if(this.model.get("type")=="band"){return"Not on tour near you";}else if(this.model.get("type")=="team"){return"No nearby games";}else{return"No nearby events";}},render:function(){var that=this;this.$el.html(this.template({p:this.model.toJSON()}));if(this.$(".event").length){this.model.loadEvent().on("success",function(event){if(!event){that.$(".event").text(that.getNoShowMessage());}else{that.$(".event").empty();if(that.model.get("type")=="team"){var opponent=_.find(event.performers,function(t){return t.id!=that.model.get("performer").id;});that.$(".event").text("vs ");jQuery("<a></a>").attr("href",event.url).text(opponent&&opponent.name||"TBD").appendTo(that.$(".event"));}else{jQuery("<a></a>").attr("href",event.url).html(SG.fn.smartTruncate(event.venue.name,40,"&hellip;")).appendTo(that.$(".event"));}
jQuery("<span></span>").html(' '+event.venue.city+', '+event.venue.state+' &mdash; ').appendTo(that.$(".event"));jQuery("<span></span>").addClass("date").text(Date.parse(event.datetime_local).toString("MMM d")).appendTo(that.$(".event"));}});}
return this;}});P.PerformersPanelView=Backbone.View.extend({initialize:function(){var that=this;this.collection.on("reset",function(){that.render();});this.collection.on("add",function(pref){var per=new SG.Preferences.SinglePerformerView({model:pref});that.$el.prepend(per.render().el);});},render:function(){var that=this,likes=this.collection.filter(function(p){return p.get("tracked");});$("#performer-panel-loading").hide();if(likes.length===0){$('#no-performers-message').show();}else{$('#no-performers-message').hide();that.$(".tracked-performer").remove();_.each(likes,function(m){var per=new P.SinglePerformerView({model:m});that.$el.append(per.render().el);});}}});P.PerformerAutocompleteView=Backbone.View.extend({initialize:function(){this.input=this.$("input");this.results=this.$(".results");},render:function(){var that=this,cache={},url="/autocomplete?types[]=teamband&taxonomies.name=concert&taxonomies.name=sports",lastXhr;this.input.autocomplete({minLength:2,appendTo:that.results,autoFocus:true,source:function(request,response){var params={term:request.term,limit:5},term=request.term;if(term in cache){response(cache[term]);return;}
lastXhr=jQuery.getJSON(url,params,function(data,status,xhr){cache[term]=data.results.teamband;if(xhr===lastXhr){response(data.results.teamband);}});},focus:function(event,ui){return false;},select:function(event,ui){that.trigger("select",ui.item.id);return false;}});this.input.data("autocomplete")._renderItem=function(ul,item){return jQuery("<li></li>").data("item.autocomplete",item).append("<a>"+item.term+"</a>").appendTo(ul);};this.input.data("autocomplete")._move=function(direction,event){if(!this.menu.element.is(":visible")){this.search(null,event);return;}
if(this.menu.first()&&/^previous/.test(direction)||this.menu.last()&&/^next/.test(direction)){return;}
this.menu[direction](event);};this.input.data("autocomplete")._suggest=function(items){var ul=this.menu.element.empty().zIndex(this.element.zIndex()+1);this._renderMenu(ul,items);this.menu.deactivate();this.menu.refresh();ul.show();this._resizeMenu();ul.position(jQuery.extend({of:this.element},this.options.position));if(this.options.autoFocus){this.menu.next(new jQuery.Event("mouseover"));}};this.input.data("autocomplete").menu.refresh=function(){var self=this;$('.ui-autocomplete-input').removeClass('ui-autocomplete-loading');var items=this.element.children("li:not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","menuitem");items.children("a").addClass("ui-corner-all").attr("tabindex",-1).mouseenter(function(event){self.activate(event,jQuery(this).parent());});};},reset:function(){this.input.val("");this.input.keyup();}});P.LocationSelectorView=Backbone.View.extend({initialize:function(){this.input=this.$("input");this.results=this.$(".results");},render:function(){var that=this,cache={},url="/autocomplete?types[]=location",lastXhr;this.input.autocomplete({minLength:2,appendTo:that.results,autoFocus:true,source:function(request,response){var params={term:request.term,limit:5},term=request.term;if(term in cache){response(cache[term]);return;}
$('#location-loading').show();lastXhr=$.getJSON(url,params,function(data,status,xhr){cache[term]=data.results.location;if(xhr===lastXhr){response(data.results.location);}});},focus:function(event,ui){return false;},select:function(event,ui){that.input.val(ui.item.term);that.trigger("select",{location_id:ui.item.id});return false;}});this.input.data("autocomplete")._renderItem=function(ul,item){return $("<li></li>").data("item.autocomplete",item).append("<a>"+item.term+"</a>").appendTo(ul);};this.input.data("autocomplete")._move=function(direction,event){if(!this.menu.element.is(":visible")){this.search(null,event);return;}
if(this.menu.first()&&/^previous/.test(direction)||this.menu.last()&&/^next/.test(direction)){return;}
this.menu[direction](event);};this.input.data("autocomplete").menu.refresh=function(){var self=this;$('#location-loading').hide();$('.ui-autocomplete-input').removeClass('ui-autocomplete-loading');var items=this.element.children("li:not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","menuitem");items.children("a").addClass("ui-corner-all").attr("tabindex",-1).mouseenter(function(event){self.activate(event,$(this).parent());});if(that.input.data("autocomplete").options.autoFocus){this.next(new $.Event("mouseover"));}};this.on("select",function(){that.$(".error").hide();});$(this.el).submit(function(e){e.preventDefault();var val=that.input.val().replace(/\s/,"");if(that.isValidPostalCode(val)){that.trigger("select",{postal_code:val});if($('#location').length)$('#location').html('<em>Loading&hellip;</em>');}else{if(that.input.val()!==that.input.attr('location')){that.$(".error").text("Please enter a valid zip code or city").show();$('#location-loading').hide();$('.ui-autocomplete-input').removeClass('ui-autocomplete-loading');}}});},reset:function(){this.$(".error").hide();this.input.val("").trigger('reset-ghost').data("autocomplete").close();},isValidPostalCode:function(postal_code){var mo=postal_code.match(/^(?:\d{5}|[a-z]\d[a-z]\d[a-z]\d)$/i);return!!(mo&&mo.length);}});})(jQuery);window.sglightbox=(function(){var ready=false,modal=jQuery('<div id="sglightbox_modal"></div'),overlay=jQuery('<div id="sglightbox_overlay"></div'),active=false,elem=null,elem_origin=null;modal.hide();overlay.css("display","none");function init(){var that=this;if(ready)return;jQuery("body").prepend(modal);jQuery("body").prepend(overlay);overlay.click(function(e,el){sglightbox.close();});modal.delegate(".close","click",function(e){sglightbox.close();return false;});ready=true;}
return{open:function(insert){init();this.reset();if(insert&&insert.nodeType){elem=insert;elem_origin=jQuery(insert).parent()[0];modal.append(insert);jQuery(insert).show();}
else if(typeof insert==="string"){modal.html(insert);}
overlay.show().animate({opacity:0.5},200);modal.trigger("openModal");modal.show();this.position_modal();overlay.css({height:jQuery(document).height()+"px"});this.active=true;return modal;},close:function(callback){var that=this;overlay.fadeOut(200);modal.trigger("closeModal").animate({marginTop:(modal.height()*-1-20),opacity:0},200,function(){that.reset();});jQuery(window).trigger("sglightbox:close");this.active=false;if(typeof callback==='function'){callback();}},reset:function(){clearTimeout(this.resetting);if(elem&&elem_origin){jQuery(elem).hide();jQuery(elem_origin).append(elem);}
modal.html("");},position_modal:function(){var overh=jQuery(window).height(),modlh=modal.height(),modlw=modal.width(),margin_left=modlw*(-0.5);modal.css({marginLeft:margin_left+"px",marginTop:(modlh*-1-20)+"px",opacity:0}).animate({marginTop:0,opacity:1},200);},show_page:function(page){page=jQuery(page);if(page.is(".page")){page.siblings().hide();page.show();}
this.position_modal();}};})();jQuery('body').live('keyup',function(event){if(event.keyCode==27&&sglightbox.active){sglightbox.close();}});jQuery(function(){jQuery('.login-register-popup .column-left .facebook-login .facebook-button').tooltip({title:'When you track performers and events on SeatGeek, they will be shared on your Facebook timeline',placement:'right'});});var SG=window.SG||{};window.SG=SG;SG.SponsorshipTemplates={"event-listing":function(scripts){scripts=scripts===undefined?true:scripts;return['<% if (data.is_only_link !== undefined && data.is_only_link == 1) { %>','<div class="sidebar-sponsor sponsored-result sponsorship-is-only-link <%= data.short_name %>-sponsored" style="background-image: url(<%= data.image_one %>);height:83px">','<a style="height:100%;width:100%;display: block;" target="_blank" class="sponsor-cta" href="<%= data.url %>"></a>','<% if (data.tracker_image !== undefined && data.tracker_image) { %><img style="text-decoration:none;border:0;padding:0;margin:0;" src="<%= data.tracker_image %>" /><% } %>','</div>','<% } else { %>','<div class="sidebar-sponsor sponsored-result <%= data.short_name %>-sponsored">','<% if (data.url !== undefined) { %><a class="logo sponsor-logo link-out" href="<%= data.url %>" target="_blank"></a><% } else { %><div class="logo sponsor-logo"></div><% } %>','<a href="#" class="btn sponsor-cta <% if (!jQuery("#market").val() && data.identifier == "ticketsnow-nfl") { %>sponsor-cta-two-lines <% } %>">','<% if (jQuery("#market").val()) { %>Show All Listings<% } else { if (data.identifier == "ticketsnow-nfl") { %>Show only NFL Ticket Exchange<% } else { %>Show only <%= data.company_name %><% } } %>','</a>','<% if (data.url !== undefined) { %><a class="sponsor-message link-out" href="<%= data.url %>" target="_blank">Visit<img src="images/map/new/external-link.png" /></a><% } %>','<% if (jQuery("#market").val()) { %><div class="sponsor-spacer"></div><div class="sponsor-indicator">Currently only showing listings from <%= data.company_name %></div><% } %>','<div class="sponsor-badge">Sponsor</div>','<% if (data.tracker_image !== undefined && data.tracker_image) { %><img style="text-decoration:none;border:0;padding:0;margin:0;" src="<%= data.tracker_image %>" /><% } %>','</div>','<% } %>'].join("\n");},"event-lowerbar":function(scripts){scripts=scripts===undefined?true:scripts;return['<div class="<%= data.identifier %>-sponsorship lower-bar" id="lower-bar-module">','<div class="end"></div>','<div class="inner">','<a href="<%= data.url %>" rel="nofollow" target="_blank" id="sponsorship_link">','<div class="sponsorship-container">','<div class="lower-label">Sponsored</div>','<div class="lower-image"><img src="<%= data.image_one %>" title="<%= data.tagline %>" /></div>','<div class="lower-tagline">','<%= data.tagline %>','<% if (data.tracker_image !== undefined && data.tracker_image) { %><img style="text-decoration:none;border:0;padding:0;margin:0;" src="<%= data.tracker_image %>" /><% } %>','</div>','</div>','</a>','</div>','</div>',(scripts===true?['<script type="text/javascript">','_gaq.push(["_trackEvent", "ads", "impression", "event-lowerbar-<%= data.identifier %>", undefined, true]);','(new SG.Tracker()).track({ category: "ad:impression:<%= data.campaign_id %>", detail: "event-lowerbar-<%= data.identifier %>", placement_id: "<%= data.placement_id %>" });','jQuery(function () {','jQuery(".<%= data.identifier %>-sponsorship a").click(function(e) {','_gaq.push(["_trackEvent", "ads", "click", "event-lowerbar-<%= data.identifier %>", undefined, true]);','(new SG.Tracker()).track({ category: "ad:click:<%= data.campaign_id %>", detail: "event-lowerbar-<%= data.identifier %>", placement_id: "<%= data.placement_id %>" });','});','});','</script>'].join("\n"):'')].join("\n");},"search-sidebar":function(scripts){scripts=scripts===undefined?true:scripts;return['<div class="<%= data.identifier %>-sponsorship sponsored-link">','<div class="sponsored-ad-label">SPONSORED</div>','<a href="<%= data.url %>" rel="nofollow" target="_blank">','<img src="<%= data.image_one %>" title="<%= data.tagline %>" />','</a>','<% if (data.tracker_image !== undefined && data.tracker_image) { %><img style="text-decoration:none;border:0;padding:0;margin:0;" src="<%= data.tracker_image %>" /><% } %>','</div>',(scripts===true?['<script type="text/javascript">','_gaq.push(["_trackEvent", "ads", "impression", "search-sidebar-<%= data.identifier %>", undefined, true]);','(new SG.Tracker()).track({ category: "ad:impression:<%= data.campaign_id %>", detail: "search-sidebar-<%= data.identifier %>", placement_id: "<%= data.placement_id %>" });','jQuery(function () {','jQuery(".<%= data.identifier %>-sponsorship a").click(function(e) {','_gaq.push(["_trackEvent", "ads", "click", "search-sidebar-<%= data.identifier %>", undefined, true]);','(new SG.Tracker()).track({ category: "ad:click:<%= data.campaign_id %>", detail: "search-sidebar-<%= data.identifier %>", placement_id: "<%= data.placement_id %>" });','});','});','</script>'].join("\n"):'')].join("\n");},"search-sidebar-twitter-widget":function(scripts){scripts=scripts===undefined?true:scripts;var ms=+new Date();return['<div class="<%= data.identifier %>-sponsorship sponsored-link" style="position: relative">','<div class="sponsored-ad-label">SPONSORED</div>','<div id="sponsored-twitter-'+ms+'"></div>','<% if (data.tracker_image !== undefined && data.tracker_image) { %><img style="text-decoration:none;border:0;padding:0;margin:0;" src="<%= data.tracker_image %>" /><% } %>','<script>','jQuery.getScript("../widgets.twimg.com/j/2/widget.js", function () {','new TWTR.Widget({','id: "sponsored-twitter-'+ms+'",','type: "<%= data.type %>",','<% if (data.type == "search") { %>search: "<%= data.search %>",<% } %>','title: "<%= data.tagline %>",','subject: "<%= data.subject %>",','version: 2,','interval: 8000,','width: 241,','height: 300,','theme: {','shell: { background: "#2b6ab1", color: "#ffffff" },','tweets: { background: "#ffffff", color: "#444444", links: "#0076dd" }','},','features: { scrollbar: true, loop: true, live: true, behavior: "default" }','}).render()<% if (data.type == "profile") { %>.setUser("<%= data.username %>")<% } %>.start();','});','</script>','</div>',(scripts===true?['<script type="text/javascript">','_gaq.push(["_trackEvent", "ads", "impression", "<%= data.identifier %>-sponsorship-twitter-widget", undefined, true]);','(new SG.Tracker()).track({ category: "ad:impression:<%= data.campaign_id %>", detail: "<%= data.identifier %>-sponsorship-twitter-widget", placement_id: "<%= data.placement_id %>" });','jQuery(function () {','jQuery(".twtr-tweets a").click(function(e) {','_gaq.push(["_trackEvent", "ads", "click", "<%= data.identifier %>-sponsorship-twitter-widget", undefined, true]);','(new SG.Tracker()).track({ category: "ad:click:<%= data.campaign_id %>", detail: "<%= data.identifier %>-sponsorship-twitter-widget", placement_id: "<%= data.placement_id %>" });','});','});','</script>'].join("\n"):'')].join("\n");},"event-on-field":function(scripts){scripts=scripts===undefined?true:scripts;return['<div class="<%= data.identifier %> <%= data.classes %> sponsorship-overlay">','<img src="<%= data.image_one %>" class="sponsor-ad" />','<img src="<%= data.tracker_image %>" style="border: none; opacity: 0.01; width: 1px; height: 1px; position: absolute; bottom: 0; right: 0;" />','<div style="clear: both"></div>','</div>'].join("\n");},"event-on-field-popup-modal":function(scripts){scripts=scripts===undefined?true:scripts;return['<div class="<%= data.identifier %> sponsorship-modal ip popupv3">','<% if (data.company_name) { %>','<div class="header">','<h2>sponsored by <%= data.company_name %></h2>','<a href="#" id="popup-close" class="close">&times;</a>','</div>','<% } %>','<div class="body">','<div class="tab">','<%= data.tagline %>','<a href="<%= data.url %>" class="modal-clickout blueBut" target="_blank">','Click here for details','<a>','</div>','</div>','</div>',].join("");},"event-on-field-ga":function(scripts){scripts=scripts===undefined?true:scripts;return['<a class="<%= data.identifier %>-sponsorship-ga sponsored-ga" href="<%= data.url %>" target="_blank" style="background-image: url(<%= data.image_one %>)"></a>','<% if (data.tracker_image !== undefined && data.tracker_image) { %><img style="text-decoration:none;border:0;padding:0;margin:0;" src="<%= data.tracker_image %>" /><% } %>',(scripts===true?['<script type="text/javascript">','_gaq.push(["_trackEvent", "ads", "impression", "<%= data.identifier %>-sponsorship-on-field", undefined, true]);','(new SG.Tracker()).track({ category: "ad:impression:<%= data.campaign_id %>", detail: "<%= data.identifier %>-sponsorship-on-field", placement_id: "<%= data.placement_id %>" });','jQuery(function () {','jQuery(".<%= data.identifier%>-sponsorship-ga").click(function(e) {','_gaq.push(["_trackEvent", "ads", "click", "<%= data.identifier %>-sponsorship-on-field", undefined, true]);','(new SG.Tracker()).track({ category: "ad:click:<%= data.campaign_id %>", detail: "<%= data.identifier %>-sponsorship-on-field", placement_id: "<%= data.placement_id %>" });','});','});','</script>'].join("\n"):'')].join("\n");},"event-post-purchase-modal":function(scripts){scripts=scripts===undefined?true:scripts;return['<div class="<%= data.identifier %>-sponsorship-modal sponsorship-modal-placement">','<h4><%= data.tagline %></h4>','<a href="<%= data.url %>" target="_blank" class="sponsored-logo"><img src="<%= data.image_one %>" alt="<%= data.tagline %>"/></a>','<a href="<%= data.url %>" target="_blank" class="sponsored-button"></a>','<div class="sponsored-image"></div>','<div class="sponsored-ad-label">Sponsored</div>','<% if (data.tracker_image !== undefined && data.tracker_image) { %><img style="text-decoration:none;border:0;padding:0;margin:0;" src="<%= data.tracker_image %>" /><% } %>','</div>',(scripts===true?['<script type="text/javascript">','_gaq.push(["_trackEvent", "ads", "impression", "<%= data.identifier %>-post-click-modal", undefined, true]);','(new SG.Tracker()).track({ category: "ad:impression:<%= data.campaign_id %>", detail: "search-sidebar-<%= data.identifier %>", placement_id: "<%= data.placement_id %>" });','jQuery(function () {','jQuery(".<%= data.identifier%>-sponsorship-modal a").click(function(e) {','_gaq.push(["_trackEvent", "ads", "click", "<%= data.identifier %>-post-click-modal", undefined, true]);','(new SG.Tracker()).track({ category: "ad:click:<%= data.campaign_id %>", detail: "search-sidebar-<%= data.identifier %>", placement_id: "<%= data.placement_id %>" });','});','});','</script>'].join("\n"):'')].join("\n");}};SG.Sponsorship=function(){};SG.Sponsorship.prototype.perform=function(selector,scripts){var that=this,children=jQuery(selector),parent=children.parent();scripts=scripts===undefined?true:scripts;children.each(function(){var data=that.getAttrs(this.attributes);data=that.doReplacements(data);var replacement=_.template(SG.SponsorshipTemplates[data.template](scripts),data,{variable:'data'});jQuery(this).replaceWith(replacement);});parent.on('sg:element-ready',that.callout);};SG.Sponsorship.prototype.getAttrs=function(attributes){var data={};for(var i=attributes.length-1;i>=0;i--){data[attributes[i].nodeName]=attributes[i].nodeValue;if(attributes[i].nodeName=='replacements'){data[attributes[i].nodeName]=jQuery.parseJSON(attributes[i].nodeValue);}}
return data;};SG.Sponsorship.prototype.doReplacements=function(data){if(data.replacements){jQuery.each(data,function(k,v){if(k!=='replacements'){data[k]=_.template(""+v,data.replacements,{variable:'data'});}});}
return data;};SG.Sponsorship.prototype.callout=function(e){jQuery(e.target).trigger('sg:sponsorship-load');};SG.Sponsorship.prototype.injectClasses=function(data){var classes=[],keys=['event_type','performer_id','performer_slug','venue_id'];if(data.replacements){_.each(keys,function(key){classes.push(key.replace('_','-')+"-"+data.replacements[key]);});}
data.classes=classes.join(" ");return data;};if(typeof deconcept=="undefined"){var deconcept=new Object();}if(typeof deconcept.util=="undefined"){deconcept.util=new Object();}if(typeof deconcept.SWFObjectUtil=="undefined"){deconcept.SWFObjectUtil=new Object();}deconcept.SWFObject=function(_1,id,w,h,_5,c,_7,_8,_9,_a){if(!document.getElementById){return;}this.DETECT_KEY=_a?_a:"detectflash";this.skipDetect=deconcept.util.getRequestParameter(this.DETECT_KEY);this.params=new Object();this.variables=new Object();this.attributes=new Array();if(_1){this.setAttribute("swf",_1);}if(id){this.setAttribute("id",id);}if(w){this.setAttribute("width",w);}if(h){this.setAttribute("height",h);}if(_5){this.setAttribute("version",new deconcept.PlayerVersion(_5.toString().split(".")));}this.installedVer=deconcept.SWFObjectUtil.getPlayerVersion();if(!window.opera&&document.all&&this.installedVer.major>7){deconcept.SWFObject.doPrepUnload=true;}if(c){this.addParam("bgcolor",c);}var q=_7?_7:"high";this.addParam("quality",q);this.setAttribute("useExpressInstall",false);this.setAttribute("doExpressInstall",false);var _c=(_8)?_8:window.location;this.setAttribute("xiRedirectUrl",_c);this.setAttribute("redirectUrl","");if(_9){this.setAttribute("redirectUrl",_9);}};deconcept.SWFObject.prototype={useExpressInstall:function(_d){this.xiSWFPath=!_d?"expressinstall.swf":_d;this.setAttribute("useExpressInstall",true);},setAttribute:function(_e,_f){this.attributes[_e]=_f;},getAttribute:function(_10){return this.attributes[_10];},addParam:function(_11,_12){this.params[_11]=_12;},getParams:function(){return this.params;},addVariable:function(_13,_14){this.variables[_13]=_14;},getVariable:function(_15){return this.variables[_15];},getVariables:function(){return this.variables;},getVariablePairs:function(){var _16=new Array();var key;var _18=this.getVariables();for(key in _18){_16[_16.length]=key+"="+_18[key];}return _16;},getSWFHTML:function(){var _19="";if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","PlugIn");this.setAttribute("swf",this.xiSWFPath);}_19="<embed type=\"application/x-shockwave-flash\" src=\""+this.getAttribute("swf")+"\" width=\""+this.getAttribute("width")+"\" height=\""+this.getAttribute("height")+"\" style=\""+this.getAttribute("style")+"\"";_19+=" id=\""+this.getAttribute("id")+"\" name=\""+this.getAttribute("id")+"\" ";var _1a=this.getParams();for(var key in _1a){_19+=[key]+"=\""+_1a[key]+"\" ";}var _1c=this.getVariablePairs().join("&");if(_1c.length>0){_19+="flashvars=\""+_1c+"\"";}_19+="/>";}else{if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","ActiveX");this.setAttribute("swf",this.xiSWFPath);}_19="<object id=\""+this.getAttribute("id")+"\" classid=\"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000\" width=\""+this.getAttribute("width")+"\" height=\""+this.getAttribute("height")+"\" style=\""+this.getAttribute("style")+"\">";_19+="<param name=\"movie\" value=\""+this.getAttribute("swf")+"\" />";var _1d=this.getParams();for(var key in _1d){_19+="<param name=\""+key+"\" value=\""+_1d[key]+"\" />";}var _1f=this.getVariablePairs().join("&");if(_1f.length>0){_19+="<param name=\"flashvars\" value=\""+_1f+"\" />";}_19+="</object>";}return _19;},write:function(_20){if(this.getAttribute("useExpressInstall")){var _21=new deconcept.PlayerVersion([6,0,65]);if(this.installedVer.versionIsValid(_21)&&!this.installedVer.versionIsValid(this.getAttribute("version"))){this.setAttribute("doExpressInstall",true);this.addVariable("MMredirectURL",encodeURIComponent(this.getAttribute("xiRedirectUrl")));document.title=document.title.slice(0,47)+" - Flash Player Installation";this.addVariable("MMdoctitle",document.title);}}if(this.skipDetect||this.getAttribute("doExpressInstall")||this.installedVer.versionIsValid(this.getAttribute("version"))){var n=(typeof _20=="string")?document.getElementById(_20):_20;n.innerHTML=this.getSWFHTML();if(!(navigator.plugins&&navigator.mimeTypes.length))window[this.getAttribute('id')]=document.getElementById(this.getAttribute('id'));return true;}else{if(this.getAttribute("redirectUrl")!=""){document.location.replace(this.getAttribute("redirectUrl"));}}return false;}};deconcept.SWFObjectUtil.getPlayerVersion=function(){var _23=new deconcept.PlayerVersion([0,0,0]);if(navigator.plugins&&navigator.mimeTypes.length){var x=navigator.plugins["Shockwave Flash"];if(x&&x.description){_23=new deconcept.PlayerVersion(x.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+r|\s+b[0-9]+)/,".").split("."));}}else{if(navigator.userAgent&&navigator.userAgent.indexOf("Windows CE")>=0){var axo=1;var _26=3;while(axo){try{_26++;axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+_26);_23=new deconcept.PlayerVersion([_26,0,0]);}catch(e){axo=null;}}}else{try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");}catch(e){try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");_23=new deconcept.PlayerVersion([6,0,21]);axo.AllowScriptAccess="always";}catch(e){if(_23.major==6){return _23;}}try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");}catch(e){}}if(axo!=null){_23=new deconcept.PlayerVersion(axo.GetVariable("$version").split(" ")[1].split(","));}}}return _23;};deconcept.PlayerVersion=function(_29){this.major=_29[0]!=null?parseInt(_29[0]):0;this.minor=_29[1]!=null?parseInt(_29[1]):0;this.rev=_29[2]!=null?parseInt(_29[2]):0;};deconcept.PlayerVersion.prototype.versionIsValid=function(fv){if(this.major<fv.major){return false;}if(this.major>fv.major){return true;}if(this.minor<fv.minor){return false;}if(this.minor>fv.minor){return true;}if(this.rev<fv.rev){return false;}return true;};deconcept.util={getRequestParameter:function(_2b){var q=document.location.search||document.location.hash;if(_2b==null){return q;}if(q){var _2d=q.substring(1).split("&");for(var i=0;i<_2d.length;i++){if(_2d[i].substring(0,_2d[i].indexOf("="))==_2b){return _2d[i].substring((_2d[i].indexOf("=")+1));}}}return"";}};deconcept.SWFObjectUtil.cleanupSWFs=function(){var _2f=document.getElementsByTagName("OBJECT");for(var i=_2f.length-1;i>=0;i--){_2f[i].style.display="none";for(var x in _2f[i]){if(typeof _2f[i][x]=="function"){_2f[i][x]=function(){};}}}};if(deconcept.SWFObject.doPrepUnload){if(!deconcept.unloadSet){deconcept.SWFObjectUtil.prepUnload=function(){__flash_unloadHandler=function(){};__flash_savedUnloadHandler=function(){};window.attachEvent("onunload",deconcept.SWFObjectUtil.cleanupSWFs);};window.attachEvent("onbeforeunload",deconcept.SWFObjectUtil.prepUnload);deconcept.unloadSet=true;}}if(!document.getElementById&&document.all){document.getElementById=function(id){return document.all[id];};}var getQueryParamValue=deconcept.util.getRequestParameter;var FlashObject=deconcept.SWFObject;var SWFObject=deconcept.SWFObject;(function($){'use strict';$.fn.toggleText=function(first,last){this.text((this.text()===last)?first:last);};$(function(){var $cobrand=$('.cobrand-partner'),$sidebar=$('.traditional-sidebar'),$wrapper=$('.events-wrapper'),$logoImg=$('img.logo'),$input=$('#search-input'),$searchForm=$('#search-form'),$searchGhost=$("#search-ghost"),$titles=$('a.search-recommend h4'),zip_code=$.url.param("location"),local_zip=parseInt($('.local-zip').attr('zip'),10);if($cobrand.length){$logoImg.attr('src','images/cobrand/sgLogoCobrand39x126.png').addClass('cobrand');$('.search-container').prepend($cobrand);$cobrand.removeClass('no-show');}
if($.browser.msie){$searchGhost.css("padding","7px 0 7px 10px");}
$input.focus(function(){if($input.val()===$input.attr("rel")){$input.val("");$searchGhost.show();}
$searchForm.addClass('focused');}).blur(function(){if($input.val()===""){$input.val($input.attr("rel"));}
$searchGhost.hide();$searchForm.removeClass('focused');}).on('keydown paste cut',function(){window.setTimeout(function(){if($input.val()===""){$searchGhost.fadeIn(200);}else{$searchGhost.hide();}},0);});if($(".wrapper").is(".columbus_homepage, .home1")){$input.focus();}
$('.search-form').submit(function(){if($input.val()===$input.attr("rel")||$input.val()===''){$input.focus();return false;}});if($('.team-show').length){$.each($titles,function(){while($(this).height()>30){$(this).css('font-size',(parseFloat($(this).css('font-size'))-1)+'px');}});$('.date-filter .custom').parent().before($('.date-form'));$('.location-form').after($('.location-filter .custom').parent().show());if(zip_code.length===5&&!isNaN(parseInt(zip_code,10))){$('.location-geo').html(zip_code).addClass('selected').attr('close',$('.location-filter').attr('data-filter')).attr('href',window.location.pathname+'?'+$('.location-filter').attr('data-filter')).show().parent().show();if(!isNaN(local_zip)&&local_zip===zip_code){$('.location-geo').removeClass('selected').hide();$('.local-zip').addClass('selected').attr('close',$('.location-filter').attr('data-filter')).attr('href',window.location.pathname+'?'+$('.location-filter').attr('data-filter'));}}
$('.filter-set .selected').click(function(e){if(!$(this).is('.default')){var query=$(this).attr('close');window.location='/search/'+((query.length>0)?'?'+query:'');}
e.preventDefault();});$('.location-filter .custom').click(function(e){var $filter=$('.location-filter .custom');$filter.toggleText('Custom location...','Close');$('.location-form').slideToggle(300,function(){$filter.toggleClass('close');});$('.location-form .error').html('');e.preventDefault();});$('#location-zip').submit(function(e){var $filter=$('.location-filter .custom'),zip=e.currentTarget[0].value,query=$('.location-filter').attr('data-filter');if(zip.length===5&&!isNaN(parseInt(zip,10))){$filter.toggleText('Custom location...','Close');$('.location-form').slideToggle(300,function(){$filter.toggleClass('close');});window.location='search/indexd41d.html?'
+((query.length>0)?query+'&':'')
+'location='+zip;}else{$('.location-form .error').html('Location not recognized.');}
e.preventDefault();});$("#location-zip input").ghost("Enter zip");$sidebar.on('sg:sponsorship-load sg:element-ready',function(){$wrapper.css({minHeight:$sidebar.height()+200});});window.setTimeout(function(){$sidebar.trigger('sg:element-ready');},200);}});}(window.jQuery));(function(){var tracker_base="http://seatgeek.com/tracker.gif",SG=window.SG||{};window.SG=SG;SG.Tracker=function(){};SG.Tracker.prototype={track:function(params){var tracker_img=new Image();params=params||{};params["_id"]=this.getUuid();params["sg_uuid"]=this.getSgUuid();params["url"]=location.href;params["user_id"]=SG.get_user_id();tracker_img.src=tracker_base+"?"+SG.fn.serializeParams(params);},getSgUuid:function(){return SG.get_cookie("sg_uuid");},getUuid:function(){this.uuid=this.uuid||SG.fn.uuid();return this.uuid;},getRef:function(){return this.getUuid();}};})();jQuery(function($){var views=['start','location','connect','add','finish'],buttons=['Let\'s get started!','Continue','Continue','Finish','Done!'],redirect='index.html',view=0,lastView=null,maxView=4;if($('.welcome-wrapper').length){var connectSprite=new Image(),checkmark=new Image();connectSprite.src="images/new/static/firstrun/connect.png";checkmark.src="images/new/static/firstrun/checkmark.png";var page=$('.welcome-wrapper'),locationTimer=null;var button=$('#next-button');button.add('#skip-button').click(function(e){e.preventDefault();nextView();});$('#back-button').click(function(e){e.preventDefault;prevView();});function nextView(){if(view>=maxView)return completedWelcome();page.find('.welcome-view.'+views[view]).hide();lastView=view;view++;page.find('.welcome-view.'+views[view]).show();setView();}
function prevView(){if(view<=0)return;page.find('.welcome-view.'+views[view]).hide();view--;page.find('.welcome-view.'+views[view]).show();lastView=view;setView();}
function setView(){button.html(buttons[view]);page.find('.current-step').stop().animate({left:(105*view)+'px'},200).html(view+"/"+maxView);page.find('.segment-'+lastView+' .green').animate({width:view==lastView?'0%':'100%'},200);if(view>0)$('#back-button').fadeIn();else $('#back-button').fadeOut();if(view<maxView&&view>0)$('#skip-button').fadeIn();else $('#skip-button').fadeOut();if(view==1)$('#location-input').focus();if(view==3){$('#add-input').focus();$('.welcome-view').stop().animate({height:'640px'},200).addClass('no-background');if($('#performers-panel *').length){$('#added-success').show();}
else{$('#added-success').hide();}}
else{$('.welcome-view').stop().animate({height:'340px'},200).removeClass('no-background');}}
function completedWelcome(){window.location=redirect;}
$('#location-input').keydown(function(){page.find('.saved').hide();});window.location_selector=new SG.Preferences.LocationSelectorView({el:$("#location-select-form")});window.location_selector.on("select",function(data){$.ajax({url:'/geoupdate',type:'POST',data:data,success:function(resp){$('#location-input').val(resp.city+', '+resp.region).attr('location',resp.city+', '+resp.region).attr('value',resp.city+', '+resp.region).blur();$("#location-select-form .saved").fadeIn(250);$('#location-loading, .sg-loading-indicator').hide();}});});$('#location-input').on('keyup',function(e){var loc_input=$(this);if(e.which==13){if(loc_input.attr('location')==loc_input.val()){nextView();}}});window.location_selector.input.focus(function(){var that=this;_.defer(function(){$(that).select();});});window.location_selector.render();var tracked_performers=new SG.Preferences.Performers();tracked_performers.on("add remove reset",function(pref){SG.set_cookie("sg_recompute","1",7*24*60*60*1000);});tracked_performers.fetch();var tracked_performers_view=new SG.Preferences.PerformersPanelView({el:$('#performers-panel'),collection:tracked_performers});var autocomplete=new SG.Preferences.PerformerAutocompleteView({el:$("#performers-panel-lower")});autocomplete.render();autocomplete.on("select",function(performer_id){var prexisting=tracked_performers.find(function(p){return p.get("performer").id==performer_id;});if(prexisting&&prexisting.get("explicit").preference=="like"){alert("You're already tracking that performer.");}else{$.ajax({type:"POST",url:"/preferences",data:{"performer.id":performer_id,"explicit.preference":"like","xsrf_token":SG.user.xsrf_token},success:function(resp){$('#add-input').val('').focus();$('#team-input label').fadeIn(250);if(prexisting){tracked_performers.remove(prexisting);$("#performers-panel-lower .tracked-performer").each(function(){var perf=jQuery(this).clone();perf.find('.remove').remove();if(perf.text().trim()==prexisting.get("performer").name){$(this).remove();}});}
tracked_performers.add([resp.preference]);if(resp.facebook=="reauth"){SG.fb_relogin();}},error:function(){alert("Whoops, there was an error adding your preference.");}});}});var SpotifyConnectView=Backbone.View.extend({events:{"click .connect-buttonset .blueBut":"handlePrimaryBtnClick"},render:function(){if(this.isConnected()){this.trigger("connected");}},isConnected:function(){return tracked_performers.any(function(p){return p.get("spotify").in_library;});},open:function(){this.$(".connect-buttonset .secondary-button").hide();this.$(".connect-buttonset .blueBut").html("Open the App &rsaquo;");sglightbox.open(this.el);},close:function(){sglightbox.close();},handlePrimaryBtnClick:function(e){var secondary_btn=this.$(".connect-buttonset .secondary-button"),primary_btn=this.$(".connect-buttonset .blueBut");if(secondary_btn.is(":visible")){e.preventDefault();tracked_performers.fetch();this.close();}else{setTimeout(function(){secondary_btn.text("Re-open the App").show();primary_btn.html("Done");},500);}}});spotify_connect=new SpotifyConnectView({el:$("#spotify-popup")});spotify_connect.on("connected",function(){$("#connect-spotify").addClass("connected").find(".label").html("Connected").addClass("green");spotify_connect.$(".info-view").hide();spotify_connect.$(".success-view").show();});tracked_performers.on("reset",function(){if(spotify_connect.isConnected()){spotify_connect.trigger("connected");}});spotify_connect.render();page.find('.section.add').on('click','.dislike',function(e){e.preventDefault();$(this).parent().hide();});page.find('.connect-buttons a').click(function(e){e.preventDefault();var that=this;var $this=$(this);switch(this.id){case'connect-facebook':SG.fb_login(function(){$(that).find('.label').html("Connected").addClass('green');});break;case'connect-spotify':spotify_connect.open();break;case'connect-lastfm':var button=$("#lastfm-connect-button"),loading=$("#lastfm-loading"),err=$("#lastfm-link-error"),success=$("#lastfm-popup").find(".success-view"),form=$("#lastfm-popup").find(".form-view");if($(that).find('.label').hasClass('green')){form.hide();success.show();}
sglightbox.open($('#lastfm-popup')[0]);$('#lastfm-username').focus();$('#lastfm-form').unbind("submit").submit(function(e){e.preventDefault();button.addClass("disabled").val("Loading...");loading.show();err.hide();$.ajax({type:"POST",url:"/account/lastfm_import/",data:{"username":$("#lastfm-username").val()},success:function(resp){button.removeClass("disabled").val("Connect");if(resp.error||!resp.icount){form.show();loading.hide();err.show();}else{form.fadeOut('slow');success.fadeIn('slow');loading.hide();tracked_performers.fetch();$(that).addClass("connected").find('.label').html("Connected").addClass('green');setTimeout(function(){sglightbox.close();},2000);}}});});break;}});}});